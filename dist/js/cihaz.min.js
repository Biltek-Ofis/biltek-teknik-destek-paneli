var islemBilgileriHover=[!1,!1,!1,!1,!1],stok_bilgileri_onaylandi=[!1,!1,!1,!1,!1];function islemHesapla(e){var a=$("#yapilanIslemMiktar"+e).val()??0,l=$("#yapilanIslemFiyat"+e).val()??0,i=$("#yapilanIslemKdv"+e).val()??0,t=a*l,n=t/100*i;$("#yapilanIslemTutar"+e).html(t>0?parseFloat(t).toFixed(2)+" TL":""),$("#yapilanIslemTopKdv"+e).html(n>0?parseFloat(n).toFixed(2)+" TL ("+i+"%)":""),tutarHesapla()}function tutarHesapla(){var e=0,a=0;for(let l=1;l<=10;l++){var i=$("#yapilanIslemMiktar"+l).val()??0,t=$("#yapilanIslemFiyat"+l).val()??0,n=$("#yapilanIslemKdv"+l).val()??0,r=i*t;a+=r/100*n,e+=r}var o=e+a;$("#yapilanIslemToplam").html(e>0?parseFloat(e).toFixed(2)+" TL":""),$("#yapilanIslemKdv").html(a>0?parseFloat(a).toFixed(2)+" TL":""),$("#yapilanIslemGenelToplam").html(o>0?parseFloat(o).toFixed(2)+" TL":"")}function stoklariGetir(e,a){e.length>1&&$.post(base_url+"/js/stok",{ara:e},function(e){Object.keys(JSON.parse(e)).length>0?($("#stok_liste_"+a).html(""),$.each(JSON.parse(e),function(e,l){var i=$('<li class="active"><a class="dropdown-item" href="javascript:void(0);" id="stok_adi_liste_oge_'+a+"_"+e+'" role="option">'+l.STOK_ADI+"</a></li>");$("#stok_liste_"+a).append(i),$("#stok_adi_liste_oge_"+a+"_"+e).on("click",function(){stokVerileri(l,a)})}),$("#stok_liste_"+a).show()):($("#stok_liste_"+a).html(""),$("#stok_liste_"+a).hide())})}function stokVerileri(e,a){$("#stokKodText"+a).html(e.STOK_KODU?e.STOK_KODU:"Yok"),$("#yapilanIslemStokKod"+a).val(e.STOK_KODU?e.STOK_KODU:""),$("#yapilanIslemMiktar"+a).val(1),$("#yapilanIslem"+a).val(e.STOK_ADI?e.STOK_ADI:""),$("#yapilanIslemFiyat"+a).val(parseFloat(e.SATIS_FIAT1?e.SATIS_FIAT1:0).toFixed(2)),$("#yapilanIslemKdv"+a).val(e.KDV_ORANI?e.KDV_ORANI:0),stok_bilgileri_onaylandi[a-1]=!0,$("#stok_liste_"+a).hide(),islemHesapla(a)}function _(e){return document.getElementById(e)}function dosyaYukle(e){var a=_("yuklenecekDosya").files[0],l=new FormData;l.append("yuklenecekDosya",a);var i=new XMLHttpRequest;i.upload.addEventListener("progress",ilerlemeDurumu,!1),i.addEventListener("load",tamamlamaDurumu,!1),i.addEventListener("error",hataDurumu,!1),i.addEventListener("abort",iptalDurumu,!1),i.open("POST",base_url+"/cihaz/medyaYukle/"+e),i.send(l)}function ilerlemeDurumu(e){var a=new Number(e.loaded/1048576),l=new Number(e.total/1048576);_("yukleme_durumu").innerHTML="Y\xfcklendi: "+a.toPrecision(5)+" MB / "+l.toPrecision(5)+" MB";var i=e.loaded/e.total*100;_("progressBar").value=Math.round(i),_("durum").innerHTML=Math.round(i)+"% y\xfcklendi"}function tamamlamaDurumu(e){var a=JSON.parse(e.target.responseText);_("durum").innerHTML=a.mesaj,_("progressBar").value=0,document.getElementById("progressDiv").style.display="none",0==a.sonuc&&(_("yukleme_durumu").innerHTML=""),1==a.sonuc&&window.location.reload()}function hataDurumu(e){_("durum").innerHTML="Y\xfckleme Başarısız"}function iptalDurumu(e){_("durum").innerHTML="Y\xfckleme İptal Edildi"}$(document).ready(function(){for(let e=1;e<=10;e++)$("#yapilanIslem"+e).focus,$("#stok_liste_"+e).hover(function(){islemBilgileriHover[e-1]=!0},function(){islemBilgileriHover[e-1]=!1}),$("#yapilanIslem"+e).focusout(function(){islemBilgileriHover[e-1]||$("#stok_liste_"+e).hide()}),$("#yapilanIslem"+e).focus(function(){var a=$("#yapilanIslem"+e).val();stok_bilgileri_onaylandi[e-1]||stoklariGetir(a,e)}),$("#yapilanIslem"+e).keyup(function(){$("#stokKodText"+e).html("Yok"),$("#yapilanIslemStokKod"+e).val("");var a=$("#yapilanIslem"+e).val();a.length>0?($("#yapilanIslemMiktar"+e).prop("required",!0),$("#yapilanIslemFiyat"+e).prop("required",!0)):($("#yapilanIslemMiktar"+e).prop("required",!1),$("#yapilanIslemFiyat"+e).prop("required",!1)),stoklariGetir(a,e)}),$("#yapilanIslemMiktar"+e+", #yapilanIslemFiyat"+e+", #yapilanIslemKdv"+e).keyup(function(){islemHesapla(e)})});